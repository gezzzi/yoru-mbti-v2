// ã‚¿ã‚°ç›¸æ€§è¨ˆç®—ã®æ”¹å–„ãƒ­ã‚¸ãƒƒã‚¯

// ã‚¿ã‚°ã®é‡è¦åº¦å®šç¾©ï¼ˆä¸€è‡´æ™‚ã¨æ¸›ç‚¹æ™‚ã§åˆ¥ã€…ï¼‰
export const tagImportance: Record<string, { match: number; penalty: number }> = {
  'ğŸ”¥ æ¬²æœ›ã®ç‚': {
    match: 1.5,    // ä¸€è‡´æ™‚ã¯é‡è¦ï¼ˆæƒ…ç†±ã®å…±æœ‰ã¯å¤§åˆ‡ï¼‰
    penalty: 0.8   // æ¸›ç‚¹æ™‚ã¯ä¸­ç¨‹åº¦ï¼ˆé•ã„ãŒã‚ã£ã¦ã‚‚è‡´å‘½çš„ã§ã¯ãªã„ï¼‰
  },
  'ğŸ’‹ ã‚­ã‚¹é­”': {
    match: 1.2,    // ä¸€è‡´æ™‚ã¯é‡è¦
    penalty: 0.5   // æ¸›ç‚¹æ™‚ã¯è»½ã‚ï¼ˆã‚­ã‚¹ã®å¥½ã¿ã®é•ã„ã¯èª¿æ•´å¯èƒ½ï¼‰
  },
  'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': {
    match: 1.4,    // ä¸€è‡´æ™‚ã¯é‡è¦ï¼ˆé›°å›²æ°—ã®å…±æœ‰ã¯å¤§åˆ‡ï¼‰
    penalty: 1.2   // æ¸›ç‚¹æ™‚ã‚‚é‡è¦ï¼ˆãƒ­ãƒãƒ³ãƒãƒƒã‚¯ã•ã®é•ã„ã¯å½±éŸ¿å¤§ï¼‰
  },
  'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': {
    match: 0.8,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 1.3   // æ¸›ç‚¹æ™‚ã¯é‡è¦ï¼ˆãƒ†ãƒ³ãƒã®é•ã„ã¯ã‚¹ãƒˆãƒ¬ã‚¹ã«ãªã‚‹ï¼‰
  },
  'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': {
    match: 1.3,    // ä¸€è‡´æ™‚ã¯é‡è¦ï¼ˆã‚±ã‚¢ã®ä¾¡å€¤è¦³ã®ä¸€è‡´ï¼‰
    penalty: 1.0   // æ¸›ç‚¹æ™‚ã‚‚æ¨™æº–çš„ã«é‡è¦
  },
  'ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾': {
    match: 1.1,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦ã®é‡è¦æ€§
    penalty: 0.6   // æ¸›ç‚¹æ™‚ã¯è»½ã‚ï¼ˆãªãã¦ã‚‚å•é¡Œãªã„ï¼‰
  },
  'â˜€ï¸ æœå‹ã‚¨ãƒ­ã‚¹': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.7   // æ¸›ç‚¹æ™‚ã¯è»½ã‚ï¼ˆæ™‚é–“å¸¯ã¯èª¿æ•´å¯èƒ½ï¼‰
  },
  'ğŸŒ™ å¤œå‹ã‚¨ãƒ­ã‚¹': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.7   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ”„ ãƒªãƒ”ãƒ¼ãƒˆæ±‚ã‚æ´¾': {
    match: 1.2,    // ä¸€è‡´æ™‚ã¯é‡è¦
    penalty: 0.9   // æ¸›ç‚¹æ™‚ã¯ä¸­ç¨‹åº¦
  },
  'ğŸ—£ ä¸‹ãƒã‚¿OK': {
    match: 0.8,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.4   // æ¸›ç‚¹æ™‚ã¯è»½ã‚ï¼ˆã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ï¼‰
  },
  'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã': {
    match: 1.0,    // ä¸€è‡´æ™‚ã¯æ¨™æº–
    penalty: 0.3   // æ¸›ç‚¹æ™‚ã¯è»½ã‚ï¼ˆç‰¹æ®Šãªå¥½ã¿ãªã®ã§é•ã„ã¯æƒ³å®šå†…ï¼‰
  },
  'ğŸ® ã‚²ãƒ¼ãƒ æ´¾': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.4   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ­ ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤å¥½ã': {
    match: 1.1,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦ã®é‡è¦æ€§
    penalty: 0.5   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ§¥ ã‚³ã‚¹ãƒ—ãƒ¬æ´¾': {
    match: 1.0,    // ä¸€è‡´æ™‚ã¯æ¨™æº–
    penalty: 0.4   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ’ª ãƒ•ã‚£ã‚¸ã‚«ãƒ«é‡è¦–': {
    match: 1.2,    // ä¸€è‡´æ™‚ã¯é‡è¦
    penalty: 0.8   // æ¸›ç‚¹æ™‚ã¯ä¸­ç¨‹åº¦
  },
  'ğŸ§  ãƒ¡ãƒ³ã‚¿ãƒ«é‡è¦–': {
    match: 1.3,    // ä¸€è‡´æ™‚ã¯é‡è¦ï¼ˆç²¾ç¥çš„ç¹‹ãŒã‚Šã®é‡è¦–ï¼‰
    penalty: 0.9   // æ¸›ç‚¹æ™‚ã¯ä¸­ç¨‹åº¦
  },
  'ğŸ¯ ä¸€ç‚¹é›†ä¸­æ´¾': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.6   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸŒˆ ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³æ´¾': {
    match: 1.0,    // ä¸€è‡´æ™‚ã¯æ¨™æº–
    penalty: 0.7   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ” ç§˜å¯†ä¸»ç¾©': {
    match: 1.1,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦ã®é‡è¦æ€§
    penalty: 1.0   // æ¸›ç‚¹æ™‚ã¯æ¨™æº–
  },
  'ğŸ“¢ ã‚ªãƒ¼ãƒ—ãƒ³æ´¾': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.8   // æ¸›ç‚¹æ™‚ã¯ä¸­ç¨‹åº¦
  },
  'ğŸŒ¹ ä¸€é€”æ´¾': {
    match:1.4,    // ä¸€è‡´æ™‚ã¯é‡è¦ï¼ˆä¾¡å€¤è¦³ã®ä¸€è‡´ï¼‰
    penalty: 1.1   // æ¸›ç‚¹æ™‚ã‚‚é‡è¦
  },
  'ğŸ¦‹ è‡ªç”±æ‹æ„›æ´¾': {
    match: 1.3,    // ä¸€è‡´æ™‚ã¯é‡è¦
    penalty: 1.2   // æ¸›ç‚¹æ™‚ã‚‚é‡è¦ï¼ˆä¾¡å€¤è¦³ã®é•ã„ã¯å¤§ãã„ï¼‰
  },
  'ğŸƒâ€â™€ï¸ å³è¡Œå‹•æ´¾': {
    match: 0.8,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.7   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸ§˜â€â™€ï¸ ã˜ã£ãã‚Šæ´¾': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.7   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  },
  'ğŸª ã‚µãƒ—ãƒ©ã‚¤ã‚ºå¥½ã': {
    match: 0.9,    // ä¸€è‡´æ™‚ã¯ä¸­ç¨‹åº¦
    penalty: 0.5   // æ¸›ç‚¹æ™‚ã¯è»½ã‚
  }
};

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é‡è¦åº¦ï¼ˆå®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚¿ã‚°ç”¨ï¼‰
const defaultImportance = {
  match: 1.0,
  penalty: 0.7
};

// ã‚¿ã‚°ã®ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
export const tagCategories = {
  intensity: ['ğŸ”¥ æ¬²æœ›ã®ç‚', 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', 'ğŸ’‹ ã‚­ã‚¹é­”', 'ğŸ’ª ãƒ•ã‚£ã‚¸ã‚«ãƒ«é‡è¦–'],
  romantic: ['ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–', 'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ', 'ğŸŒ¹ ä¸€é€”æ´¾', 'ğŸ§  ãƒ¡ãƒ³ã‚¿ãƒ«é‡è¦–'],
  playful: ['ğŸ® ã‚²ãƒ¼ãƒ æ´¾', 'ğŸ­ ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤å¥½ã', 'ğŸ§¥ ã‚³ã‚¹ãƒ—ãƒ¬æ´¾', 'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã', 'ğŸª ã‚µãƒ—ãƒ©ã‚¤ã‚ºå¥½ã'],
  communication: ['ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾', 'ğŸ—£ ä¸‹ãƒã‚¿OK', 'ğŸ” ç§˜å¯†ä¸»ç¾©', 'ğŸ“¢ ã‚ªãƒ¼ãƒ—ãƒ³æ´¾'],
  timing: ['â˜€ï¸ æœå‹ã‚¨ãƒ­ã‚¹', 'ğŸŒ™ å¤œå‹ã‚¨ãƒ­ã‚¹', 'ğŸƒâ€â™€ï¸ å³è¡Œå‹•æ´¾', 'ğŸ§˜â€â™€ï¸ ã˜ã£ãã‚Šæ´¾'],
  style: ['ğŸ”„ ãƒªãƒ”ãƒ¼ãƒˆæ±‚ã‚æ´¾', 'ğŸ¯ ä¸€ç‚¹é›†ä¸­æ´¾', 'ğŸŒˆ ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³æ´¾', 'ğŸŒ¹ ä¸€é€”æ´¾', 'ğŸ¦‹ è‡ªç”±æ‹æ„›æ´¾']
};

// ã‚¿ã‚°é–“ã®ç›¸æ€§ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼ˆ1.0ãŒæ¨™æº–ã€é«˜ã„ã»ã©ç›¸æ€§è‰¯å¥½ï¼‰
export const tagCompatibilityMatrix: { [key: string]: { [key: string]: number } } = {
  'ğŸ”¥ æ¬²æœ›ã®ç‚': {
    'ğŸ”¥ æ¬²æœ›ã®ç‚': 1.3,          // åŒã˜æƒ…ç†±ãƒ¬ãƒ™ãƒ«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 1.2,    // æƒ…ç†±ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ’‹ ã‚­ã‚¹é­”': 1.1,            // æƒ…ç†±ã¨ã‚­ã‚¹ã¯è‰¯ã„çµ„ã¿åˆã‚ã›
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 0.8,        // æƒ…ç†±ã¨ãƒ­ãƒãƒ³ã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': {
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 1.3,        // ãƒ­ãƒãƒ³ãƒãƒƒã‚¯åŒå£«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 0.5,    // ãƒ­ãƒãƒ³ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ç›¸æ€§æ‚ªã„
    'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': 1.2,  // ãƒ­ãƒãƒ³ã¨ã‚±ã‚¢ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ’‹ ã‚­ã‚¹é­”': 1.1,            // ãƒ­ãƒãƒ³ã¨ã‚­ã‚¹ã¯è‰¯ã„
    'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾': 1.2,        // ãƒ­ãƒãƒ³ã¨ã¾ã£ãŸã‚Šã¯è‰¯å¥½
  },
  'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': {
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 1.2,    // ã‚¹ãƒ”ãƒ¼ãƒ‰åŒå£«ã¯è‰¯å¥½
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 0.5,        // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨ãƒ­ãƒãƒ³ã¯ç›¸æ€§æ‚ªã„
    'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': 0.5,  // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢ã¯ç›¸æ€§æ‚ªã„
    'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾': 0.4,        // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨ã¾ã£ãŸã‚Šã¯ç›¸æ€§æœ€æ‚ª
    'ğŸ’‹ ã‚­ã‚¹é­”': 0.7,            // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨ã‚­ã‚¹ã¯ã‚„ã‚„ä¸ä¸€è‡´
    'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹': 1.3,  // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨è¡å‹•ã¯æœ€é«˜
    'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–': 0.5,    // ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨è¡›ç”Ÿé‡è¦–ã¯ç›¸æ€§æ‚ªã„
  },
  'ğŸ’‹ ã‚­ã‚¹é­”': {
    'ğŸ’‹ ã‚­ã‚¹é­”': 1.3,            // ã‚­ã‚¹é­”åŒå£«ã¯æœ€é«˜
    'ğŸ”¥ æ¬²æœ›ã®ç‚': 1.1,         // ã‚­ã‚¹ã¨æƒ…ç†±ã¯è‰¯å¥½
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 1.1,        // ã‚­ã‚¹ã¨ãƒ­ãƒãƒ³ã¯è‰¯å¥½
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 0.7,    // ã‚­ã‚¹ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ã‚„ã‚„ä¸ä¸€è‡´
    'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': 1.2   // ã‚­ã‚¹ã¨ã‚±ã‚¢ã¯ç›¸æ€§è‰¯å¥½
  },
  'â›ï¸ é–‹æ‹“æ´¾': {
    'â›ï¸ é–‹æ‹“æ´¾': 1.3,            // é–‹æ‹“æ´¾åŒå£«ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ§· è»½SMè€æ€§ã‚ã‚Š': 1.2,      // é–‹æ‹“ã¨SMã¯ç›¸æ€§è‰¯å¥½
    'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾': 1.2,    // é–‹æ‹“ã¨è¦—ãè¦‹ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': 0.4,        // é–‹æ‹“ã¨å®‰å…¨ç¬¬ä¸€ã¯ç›¸æ€§æœ€æ‚ª
    'ğŸ­ ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤å¥½ã': 1.2,   // é–‹æ‹“ã¨ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ã¯è‰¯å¥½
  },
  'ğŸ§· è»½SMè€æ€§ã‚ã‚Š': {
    'ğŸ§· è»½SMè€æ€§ã‚ã‚Š': 1.3,      // SMåŒå£«ã¯ç›¸æ€§è‰¯å¥½
    'â›ï¸ é–‹æ‹“æ´¾': 1.2,            // SMã¨é–‹æ‹“ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': 0.4,        // SMã¨å®‰å…¨ç¬¬ä¸€ã¯ç›¸æ€§æœ€æ‚ª
    'ğŸšª NGæ˜ç¢º': 0.7,            // SMã¨NGæ˜ç¢ºã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾': {
    'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾': 1.3,    // è¦—ãè¦‹åŒå£«ã¯ç›¸æ€§è‰¯å¥½
    'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã': 1.2,      // è¦—ãè¦‹ã¨é¡ã¯ç›¸æ€§è‰¯å¥½
    'â›ï¸ é–‹æ‹“æ´¾': 1.2,            // è¦—ãè¦‹ã¨é–‹æ‹“ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': 0.3,        // è¦—ãè¦‹ã¨å®‰å…¨ç¬¬ä¸€ã¯ç›¸æ€§æœ€æ‚ª
  },
  'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': {
    'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': 1.3,        // å®‰å…¨ç¬¬ä¸€åŒå£«ã¯ç›¸æ€§è‰¯å¥½
    'â›ï¸ é–‹æ‹“æ´¾': 0.4,            // å®‰å…¨ã¨é–‹æ‹“ã¯ç›¸æ€§æœ€æ‚ª
    'ğŸ§· è»½SMè€æ€§ã‚ã‚Š': 0.4,      // å®‰å…¨ã¨SMã¯ç›¸æ€§æœ€æ‚ª
    'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾': 0.3,    // å®‰å…¨ã¨è¦—ãè¦‹ã¯ç›¸æ€§æœ€æ‚ª
    'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã': 0.6,      // å®‰å…¨ã¨é¡ã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': {
    'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': 1.3,  // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢åŒå£«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 0.5,    // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ç›¸æ€§æ‚ªã„
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 1.2,        // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢ã¨ãƒ­ãƒãƒ³ã¯è‰¯å¥½
    'ğŸ’‹ ã‚­ã‚¹é­”': 1.2,            // ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢ã¨ã‚­ã‚¹ã¯è‰¯å¥½
  },
  'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾': {
    'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾': 1.3,        // ã¾ã£ãŸã‚ŠåŒå£«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 0.4,    // ã¾ã£ãŸã‚Šã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ç›¸æ€§æœ€æ‚ª
    'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–': 1.2,        // ã¾ã£ãŸã‚Šã¨ãƒ­ãƒãƒ³ã¯è‰¯å¥½
    'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹': 0.6,  // ã¾ã£ãŸã‚Šã¨è¡å‹•ã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–': {
    'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–': 1.3,    // è¡›ç”Ÿé‡è¦–åŒå£«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 0.5,    // è¡›ç”Ÿã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯ç›¸æ€§æ‚ªã„
    'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ': 1.2,  // è¡›ç”Ÿã¨ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢ã¯è‰¯å¥½
    'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹': 0.6,  // è¡›ç”Ÿã¨è¡å‹•ã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã': {
    'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã': 1.3,      // é¡åŒå£«ã¯æœ€é«˜
    'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾': 1.2,    // é¡ã¨è¦—ãè¦‹ã¯ç›¸æ€§è‰¯å¥½
    'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾': 0.6,        // é¡ã¨å®‰å…¨ç¬¬ä¸€ã¯ã‚„ã‚„ä¸ä¸€è‡´
  },
  'ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾': {
    'ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾': 1.3,      // è¨€èªãƒ—ãƒ¬ã‚¤åŒå£«ã¯æœ€é«˜
    'ğŸ—£ ä¸‹ãƒã‚¿OK': 1.2,          // è¨€èªãƒ—ãƒ¬ã‚¤ã¨ä¸‹ãƒã‚¿OKã¯è‰¯å¥½
  },
  'ğŸ—£ ä¸‹ãƒã‚¿OK': {
    'ğŸ—£ ä¸‹ãƒã‚¿OK': 1.3,          // ä¸‹ãƒã‚¿OKåŒå£«ã¯æœ€é«˜
    'ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾': 1.2,      // ä¸‹ãƒã‚¿OKã¨è¨€èªãƒ—ãƒ¬ã‚¤ã¯è‰¯å¥½
  },
  'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹': {
    'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹': 1.3,  // è¡å‹•åŒå£«ã¯æœ€é«˜
    'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾': 1.3,    // è¡å‹•ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã¯æœ€é«˜
    'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾': 0.6,        // è¡å‹•ã¨ã¾ã£ãŸã‚Šã¯ã‚„ã‚„ä¸ä¸€è‡´
    'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–': 0.6,    // è¡å‹•ã¨è¡›ç”Ÿã¯ã‚„ã‚„ä¸ä¸€è‡´
  }
  // ä»–ã®ã‚¿ã‚°ã®çµ„ã¿åˆã‚ã›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ1.0ï¼‰ã‚’ä½¿ç”¨
};

// å…¨25ã‚¿ã‚°ã®ãƒªã‚¹ãƒˆ
const ALL_TAGS = [
  'ğŸ”¥ æ¬²æœ›ã®ç‚', 'ğŸ’¬ è¨€èªãƒ—ãƒ¬ã‚¤æ´¾', 'ğŸ­ ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤å¥½ã', 'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ', 'â›ï¸ é–‹æ‹“æ´¾',
  'ğŸ§· è»½SMè€æ€§ã‚ã‚Š', 'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–', 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', 'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹', 'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã',
  'ğŸšª NGæ˜ç¢º', 'ğŸ® ã‚²ãƒ¼ãƒ æ´¾', 'ğŸ§¥ ã‚³ã‚¹ãƒ—ãƒ¬æ´¾', 'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–', 'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾',
  'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾', 'ğŸ“± ãƒ‡ã‚¸ã‚¿ãƒ«å‰æˆ¯æ´¾', 'ğŸ’‹ ã‚­ã‚¹é­”', 'â˜€ï¸ æœå‹ã‚¨ãƒ­ã‚¹', 'ğŸ”„ ãƒªãƒ”ãƒ¼ãƒˆæ±‚ã‚æ´¾',
  'ğŸ—£ ä¸‹ãƒã‚¿OK', 'ğŸ“š å­¦ç¿’ç ”ç©¶æ´¾', 'ğŸ§­ ã‚¬ã‚¤ãƒ‰æ´¾', 'ğŸ¤¹â€â™€ï¸ ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯æ´¾', 'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾'
];

// æ”¹å–„ã•ã‚ŒãŸã‚¿ã‚°ç›¸æ€§è¨ˆç®—é–¢æ•°
export interface TagScore {
  tag: string;
  score: number;
}

export function calculateImprovedTagCompatibility(
  userTagScores: TagScore[],
  partnerTagScores: TagScore[]
): {
  totalScore: number;
  categoryScores: { [key: string]: number };
  detailScores: { tag: string; score: number; reason: string }[];
} {
  let totalCompatibility = 0;
  const categoryScores: { [key: string]: { score: number; count: number } } = {};
  const detailScores: { tag: string; score: number; reason: string }[] = [];

  // ã‚¿ã‚°ã‚¹ã‚³ã‚¢ã‚’ãƒãƒƒãƒ—ã«å¤‰æ›ï¼ˆé«˜é€Ÿæ¤œç´¢ç”¨ï¼‰
  const userScoreMap = new Map(userTagScores.map(t => [t.tag, t.score]));
  const partnerScoreMap = new Map(partnerTagScores.map(t => [t.tag, t.score]));

  // å…¨25ã‚¿ã‚°ã«ã¤ã„ã¦è¨ˆç®—
  ALL_TAGS.forEach(tag => {
    // å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚³ã‚¢ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°0ç‚¹ï¼‰
    const userScore = userScoreMap.get(tag) || 0;
    const partnerScore = partnerScoreMap.get(tag) || 0;
    
    const importance = tagImportance[tag] || defaultImportance;
    
    // ç‚¹æ•°å·®ã®é€†æ•°ã‚’è¨ˆç®—ï¼ˆå·®ãŒå°ã•ã„ã»ã©é«˜å¾—ç‚¹ï¼‰
    const scoreDiff = Math.abs(userScore - partnerScore);
    const inverseScore = 6 - scoreDiff; // æœ€å¤§å·®6ç‚¹ãªã®ã§ã€6ã‹ã‚‰å¼•ã
    
    // ã‚¿ã‚°ã®é‡è¦åº¦ï¼ˆä¸€è‡´æ™‚ï¼‰ã‚’æ›ã‘ã‚‹
    const tagScore = inverseScore * importance.match;
    
    totalCompatibility += tagScore;
    
    // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ã‚³ã‚¢ã®é›†è¨ˆ
    Object.entries(tagCategories).forEach(([category, tags]) => {
      if (tags.includes(tag)) {
        if (!categoryScores[category]) {
          categoryScores[category] = { score: 0, count: 0 };
        }
        categoryScores[category].score += tagScore;
        categoryScores[category].count += 1;
      }
    });
    
    // è©³ç´°ã‚¹ã‚³ã‚¢ã®è¨˜éŒ²
    detailScores.push({
      tag: tag,
      score: Math.round(tagScore * 10) / 10, // å°æ•°ç‚¹1æ¡ã¾ã§
      reason: scoreDiff === 0 
        ? `å®Œå…¨ä¸€è‡´ï¼ˆä¸¡è€…${userScore}ç‚¹ï¼‰` 
        : `${scoreDiff}ç‚¹å·®ï¼ˆ${userScore}ç‚¹ vs ${partnerScore}ç‚¹ï¼‰`
    });
  });
  
  // ã‚¿ã‚°é–“ã®ç›¸äº’ä½œç”¨ã«ã‚ˆã‚‹è¿½åŠ ãƒœãƒ¼ãƒŠã‚¹/ãƒšãƒŠãƒ«ãƒ†ã‚£
  const interactionBonus = calculateTagInteractions(userTagScores, partnerTagScores);
  totalCompatibility += interactionBonus;
  
  // ã‚¹ã‚³ã‚¢ã‚’0-100ã®ç¯„å›²ã«æ­£è¦åŒ–
  // æ­£ç¢ºãªç†è«–ä¸Šã®æœ€å¤§å€¤ã‚’è¨ˆç®—ï¼ˆå…¨25ã‚¿ã‚°ãŒå®Œå…¨ä¸€è‡´ã—ãŸå ´åˆã®å®Ÿéš›ã®é‡è¦åº¦ã‚’ä½¿ç”¨ï¼‰
  let maxPossibleScore = 0;
  ALL_TAGS.forEach(tag => {
    const importance = tagImportance[tag] || defaultImportance;
    maxPossibleScore += 6 * importance.match; // å„ã‚¿ã‚°ã®æœ€å¤§ã‚¹ã‚³ã‚¢ï¼ˆå·®0ç‚¹ = 6ç‚¹ Ã— é‡è¦åº¦ï¼‰
  });
  
  const normalizedScore = (totalCompatibility / maxPossibleScore) * 100;
  
  // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ã‚³ã‚¢ã®å¹³å‡åŒ–
  const normalizedCategoryScores: { [key: string]: number } = {};
  Object.entries(categoryScores).forEach(([category, data]) => {
    if (data.count > 0) {
      // ã‚«ãƒ†ã‚´ãƒªå†…ã®å¹³å‡ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã—ã€0-100ã«æ­£è¦åŒ–
      const avgScore = data.score / data.count;
      const maxCategoryScore = 6 * 1.5; // 6ç‚¹ Ã— æœ€å¤§é‡è¦åº¦
      normalizedCategoryScores[category] = Math.round((avgScore / maxCategoryScore) * 100);
    } else {
      normalizedCategoryScores[category] = 0;
    }
  });
  
  return {
    totalScore: Math.round(Math.max(0, Math.min(100, normalizedScore))),
    categoryScores: normalizedCategoryScores,
    detailScores
  };
}

// ã‚¿ã‚°é–“ã®ç›¸äº’ä½œç”¨ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹/ãƒšãƒŠãƒ«ãƒ†ã‚£è¨ˆç®—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
function calculateTagInteractions(
  userTagScores: TagScore[],
  partnerTagScores: TagScore[]
): number {
  let interactionPenalty = 0;
  
  // ã‚¿ã‚°ã‚¹ã‚³ã‚¢ã‚’ãƒãƒƒãƒ—ã«å¤‰æ›
  const userScoreMap = new Map(userTagScores.map(t => [t.tag, t.score]));
  const partnerScoreMap = new Map(partnerTagScores.map(t => [t.tag, t.score]));
  
  // é«˜å¾—ç‚¹ã‚¿ã‚°ï¼ˆ4ç‚¹ä»¥ä¸Šï¼‰ã‚’æŠ½å‡º
  const userHighTags = new Set<string>();
  const partnerHighTags = new Set<string>();
  
  userTagScores.forEach(t => {
    if (t.score >= 4) userHighTags.add(t.tag);
  });
  
  partnerTagScores.forEach(t => {
    if (t.score >= 4) partnerHighTags.add(t.tag);
  });
  
  // ç›¸æ€§ã®æ‚ªã„çµ„ã¿åˆã‚ã›ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä¸€æ–¹ãŒ4ç‚¹ä»¥ä¸ŠæŒã£ã¦ã„ã‚Œã°æ¸›ç‚¹ï¼‰
  const badCombinations: { tag1: string; tag2: string; penalty: number }[] = [
    // ãƒ†ãƒ³ãƒã®é•ã„
    { tag1: 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', tag2: 'ğŸ•¯ ãƒ­ãƒãƒ³é‡è¦–', penalty: -3.5 },
    { tag1: 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', tag2: 'ğŸ› ã‚¢ãƒ•ã‚¿ãƒ¼ã‚±ã‚¢å¿…é ˆ', penalty: -3.5 },
    { tag1: 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', tag2: 'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾', penalty: -4.2 },
    { tag1: 'âš¡ï¸ ã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² æ´¾', tag2: 'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–', penalty: -3.5 },
    
    // ãƒªã‚¹ã‚¯è¨±å®¹åº¦ã®é•ã„
    { tag1: 'â›ï¸ é–‹æ‹“æ´¾', tag2: 'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾', penalty: -4.2 },
    { tag1: 'ğŸ§· è»½SMè€æ€§ã‚ã‚Š', tag2: 'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾', penalty: -4.2 },
    { tag1: 'ğŸ•µï¸â€â™€ï¸ è¦—ãè¦‹èˆˆå¥®æ´¾', tag2: 'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾', penalty: -4.9 },
    
    // è¦–è¦šçš„ã‚¹ãƒªãƒ«ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
    { tag1: 'ğŸª é¡ãƒ—ãƒ¬ã‚¤å¥½ã', tag2: 'ğŸ›¡ å®‰å…¨ç¬¬ä¸€æ´¾', penalty: -2.8 },
    
    // è¡å‹•æ€§ã¨è¨ˆç”»æ€§
    { tag1: 'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹', tag2: 'ğŸ’¤ ã¾ã£ãŸã‚Šæ´¾', penalty: -2.8 },
    { tag1: 'ğŸƒâ€â™‚ï¸ è¡å‹•ãƒˆãƒªã‚¬ãƒ¼å‹', tag2: 'ğŸ§¼ ã‚±ã‚¢ï¼†è¡›ç”Ÿé‡è¦–', penalty: -2.8 },
  ];
  
  // å‡¦ç†æ¸ˆã¿ã®çµ„ã¿åˆã‚ã›ã‚’è¨˜éŒ²ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
  const processedCombos = new Set<string>();
  
  // å„çµ„ã¿åˆã‚ã›ã‚’ãƒã‚§ãƒƒã‚¯
  badCombinations.forEach(combo => {
    const userHas1 = userHighTags.has(combo.tag1);
    const userHas2 = userHighTags.has(combo.tag2);
    const partnerHas1 = partnerHighTags.has(combo.tag1);
    const partnerHas2 = partnerHighTags.has(combo.tag2);
    
    // ã©ã¡ã‚‰ã‹ãŒ tag1 ã‚’æŒã¡ã€ã‚‚ã†ä¸€æ–¹ãŒ tag2 ã‚’æŒã£ã¦ã„ã‚‹å ´åˆ
    if ((userHas1 && partnerHas2) || (userHas2 && partnerHas1)) {
      // çµ„ã¿åˆã‚ã›ã®ã‚­ãƒ¼ã‚’ä½œæˆï¼ˆé †åºã«é–¢ä¿‚ãªãåŒä¸€è¦–ï¼‰
      const comboKey = [combo.tag1, combo.tag2].sort().join('-');
      
      // ã¾ã å‡¦ç†ã—ã¦ã„ãªã„çµ„ã¿åˆã‚ã›ã®å ´åˆã®ã¿åŠ ç®—
      if (!processedCombos.has(comboKey)) {
        interactionPenalty += combo.penalty;
        processedCombos.add(comboKey);
      }
    }
  });
  
  return interactionPenalty;
}